<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sudoku</title>
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body class="App">
    <div style="margin: 2%">
      <div class="SudokuBoard" id="sudoku-board"></div>
    </div>
    <div>
      <button class="CheckResult" id="check-result">Check result</button>
    </div>
    <div>
      <h2>Dynamic Matrix Representation:</h2>
      <pre id="dynamic-matrix"></pre>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const initialBoard = [
          [5, 0, 4, 6, 7, 8, 9, 1, 2],
          [6, 0, 2, 1, 9, 5, 3, 4, 8],
          [1, 9, 0, 3, 4, 2, 5, 6, 7],
          [8, 5, 9, 7, 6, 1, 4, 0, 3],
          [4, 2, 6, 8, 5, 0, 0, 0, 1],
          [7, 1, 0, 9, 2, 4, 8, 5, 6],
          [9, 6, 1, 5, 0, 7, 0, 8, 0],
          [2, 8, 7, 4, 1, 9, 6, 3, 0],
          [3, 4, 5, 2, 8, 6, 1, 7, 0],
        ];

        const boardContainer = document.getElementById("sudoku-board");
        const checkResultButton = document.getElementById("check-result");
        const dynamicMatrixContainer =
          document.getElementById("dynamic-matrix");

        // Add the "editable" property to each cell
        const editableBoard = initialBoard.map((row) =>
          row.map((cell) => ({
            value: cell,
            editable: cell === 0, // Set to false if the cell was initially filled
          })),
        );

        function renderBoard() {
          const table = document.createElement("table");

          editableBoard.forEach((row, rowIndex) => {
            const tr = document.createElement("tr");

            row.forEach((cell, colIndex) => {
              const td = document.createElement("td");

              const input = document.createElement("input");
              input.type = "number";
              input.min = "1";
              input.max = "9";
              input.value = cell.value === 0 ? "" : String(cell.value);
              input.dataset.row = String(rowIndex);
              input.dataset.col = String(colIndex);

              input.addEventListener("input", function () {
                const row = parseInt(this.dataset.row, 10);
                const col = parseInt(this.dataset.col, 10);
                const value = parseInt(this.value, 10);

                // Check if the entered value is a valid number (1 to 9) or if it's empty
                if ((value >= 1 && value <= 9) || this.value === "") {
                  if (editableBoard[row][col].editable) {
                    handleCellChange(row, col, value || 0); // Use 0 if the value is empty
                  } else {
                    // If not editable, reset the input value
                    this.value = String(editableBoard[row][col].value);
                  }
                } else {
                  // If not a valid number or not empty, reset the input value
                  this.value = String(editableBoard[row][col].value);
                }
              });

              td.appendChild(input);
              tr.appendChild(td);

              // Add a separator cell after every third cell
              if ((colIndex + 1) % 3 === 0 && colIndex !== 8) {
                const separatorCell = document.createElement("td");
                separatorCell.classList.add("separator");
                tr.appendChild(separatorCell);
              }
            });

            table.appendChild(tr);

            // Add a separator row after every third row
            if ((rowIndex + 1) % 3 === 0 && rowIndex !== 8) {
              const separatorRow = document.createElement("tr");
              const separatorCell = document.createElement("td");
              separatorCell.colSpan = 9;
              separatorCell.classList.add("separator");
              separatorRow.appendChild(separatorCell);
              table.appendChild(separatorRow);
            }
          });

          boardContainer.innerHTML = "";
          boardContainer.appendChild(table);
        }

        function handleCellChange(row, col, value) {
          editableBoard[row][col].value = value;
        }

        function printBoard() {
          console.log(editableBoard);
        }

        function updateDynamicMatrix() {
          dynamicMatrixContainer.innerText = JSON.stringify(
            editableBoard,
            null,
            2,
          );
        }

        // Initial rendering
        renderBoard();

        // Event listeners
        checkResultButton.addEventListener("click", function () {
          printBoard();
          updateDynamicMatrix();
        });
      });
    </script>
  </body>
</html>
